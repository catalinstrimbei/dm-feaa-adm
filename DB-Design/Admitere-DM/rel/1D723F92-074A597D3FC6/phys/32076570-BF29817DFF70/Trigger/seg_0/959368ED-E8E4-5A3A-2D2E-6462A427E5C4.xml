<?xml version = '1.0' encoding = 'UTF-8'?>
<TriggerOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.TriggerOraclev10g" name="TRG_OPTIUNIFISE_UPD_AFTER_ROW" id="959368ED-E8E4-5A3A-2D2E-6462A427E5C4" directorySegmentName="seg_0">
   <createdBy>catalin.strimbei</createdBy>
   <createdTime>2011-04-20 12:49:06 UTC</createdTime>
   <changedBy>catalin.strimbei</changedBy>
   <changedTime>2011-04-20 12:49:06 UTC</changedTime>
   <ownerDesignName>Admitere-DM</ownerDesignName>
   <actions>UPDATE</actions>
   <body>DECLARE&amp;lt;br/&amp;gt;    v_are_voie BOOLEAN := FALSE ;&amp;lt;br/&amp;gt;BEGIN  &amp;lt;br/&amp;gt;    FOR i IN 1..pac_variabile_globale.vg_roluri.COUNT LOOP&amp;lt;br/&amp;gt;        IF pac_variabile_globale.vg_roluri (i) IN (&amp;apos;CORECTIE&amp;apos;, &amp;apos;DBA&amp;apos;) THEN&amp;lt;br/&amp;gt;            v_are_voie := TRUE ;&amp;lt;br/&amp;gt;        END IF ;            &amp;lt;br/&amp;gt;    END LOOP ;&amp;lt;br/&amp;gt;    IF v_are_voie = FALSE THEN&amp;lt;br/&amp;gt;        RAISE_APPLICATION_ERROR (-20155,&amp;apos;Nu aveti drepturi sa modificati OPTIUNIFISE&amp;apos;) ; &amp;lt;br/&amp;gt;    END IF ;&amp;lt;br/&amp;gt;&amp;lt;br/&amp;gt;   pac_variabile_globale.p_init_vg_atribute (&amp;apos;OPTIUNIFISE&amp;apos;) ; &amp;lt;br/&amp;gt;  &amp;lt;br/&amp;gt;    IF NVL(:NEW.idfisa,1) &amp;lt;&amp;gt; NVL(pac_variabile_globale.vg_idfisa_crt,0) THEN &amp;lt;br/&amp;gt;      SELECT seq_idmodif.NextVal INTO pac_variabile_globale.v_seq_idmodif FROM dual ;&amp;lt;br/&amp;gt;      pac_variabile_globale.vg_idfisa_crt := :NEW.idfisa ;&amp;lt;br/&amp;gt;      &amp;lt;br/&amp;gt;      pac_variabile_globale.vg_vin_din_optiuni := TRUE ;&amp;lt;br/&amp;gt;      Update Fisainscriere &amp;lt;br/&amp;gt;      Set opcorectie = admitere.pac_variabile_globale.vg_operator,&amp;lt;br/&amp;gt;        stcorectie = admitere.pac_variabile_globale.vg_statie, datacorectie = sysdate  &amp;lt;br/&amp;gt;      Where idfisa = :new.idfisa ; --AND datacorectie &amp;lt; sysdate - (5/(60*24));&amp;lt;br/&amp;gt;      pac_variabile_globale.vg_vin_din_optiuni := FALSE ;&amp;lt;br/&amp;gt;      &amp;lt;br/&amp;gt;      INSERT INTO admitere.modificari (idmodif, dataoram, operator, statiem, obs, cnp, &amp;lt;br/&amp;gt;          idfisa, tip_modif, tabela)&amp;lt;br/&amp;gt;        VALUES (pac_variabile_globale.v_seq_idmodif, SYSDATE, &amp;lt;br/&amp;gt;        admitere.pac_variabile_globale.vg_operator, &amp;lt;br/&amp;gt;         admitere.pac_variabile_globale.vg_statie,  &amp;apos;UPD-OPTIUNIFISE &amp;apos;||:NEW.codopt, &amp;lt;br/&amp;gt;         NULL, :NEW.idfisa, &amp;apos;U&amp;apos;, &amp;apos;OPTIUNIFISE&amp;apos;) ;     &amp;lt;br/&amp;gt;   END IF ;  &amp;lt;br/&amp;gt;&amp;lt;br/&amp;gt;&amp;lt;br/&amp;gt; CASE&amp;lt;br/&amp;gt;&amp;lt;br/&amp;gt;--    chestionarul nu se jurnalizeaza&amp;lt;br/&amp;gt;  WHEN (:NEW.CODOPT BETWEEN 44 AND 90) AND (:OLD.CODOPT NOT BETWEEN 44 AND 90) THEN&amp;lt;br/&amp;gt;        RAISE_APPLICATION_ERROR (-20141,&amp;apos;Nu puteti modifica coduri intre grupe de optiuni OPTIUNIFISE&amp;apos;) ; &amp;lt;br/&amp;gt;  WHEN (:NEW.CODOPT BETWEEN 744 AND 774) AND (:OLD.CODOPT NOT BETWEEN 744 AND 774) THEN&amp;lt;br/&amp;gt;        RAISE_APPLICATION_ERROR (-20142,&amp;apos;Nu puteti modifica coduri intre grupe de optiuni OPTIUNIFISE&amp;apos;) ;&amp;lt;br/&amp;gt;  WHEN :NEW.CODOPT BETWEEN 44 AND 90 OR :NEW.CODOPT BETWEEN 744 AND 774 THEN&amp;lt;br/&amp;gt;      NULL ;&amp;lt;br/&amp;gt;&amp;lt;br/&amp;gt;  -- specializari dorite la admiterea la licenta&amp;lt;br/&amp;gt;  WHEN (:NEW.CODOPT BETWEEN 14 AND 23) AND (:OLD.CODOPT NOT BETWEEN 14 AND 23) THEN&amp;lt;br/&amp;gt;        RAISE_APPLICATION_ERROR (-20143,&amp;apos;Nu puteti modifica coduri intre grupe de optiuni OPTIUNIFISE&amp;apos;) ; &amp;lt;br/&amp;gt;  WHEN (:NEW.CODOPT BETWEEN 714 AND 723) AND (:OLD.CODOPT NOT BETWEEN 714 AND 723) THEN&amp;lt;br/&amp;gt;        RAISE_APPLICATION_ERROR (-20144,&amp;apos;Nu puteti modifica coduri intre grupe de optiuni OPTIUNIFISE&amp;apos;) ; &amp;lt;br/&amp;gt;  WHEN :NEW.CODOPT BETWEEN 14 AND 23 OR :NEW.CODOPT BETWEEN 714 AND 723 THEN&amp;lt;br/&amp;gt;      INSERT INTO UPD_specializari VALUES (:NEW.idfisa, :NEW.codopt, :NEW.prioritate, pac_variabile_globale.v_seq_idmodif) ;&amp;lt;br/&amp;gt;  &amp;lt;br/&amp;gt;  -- limbile straine&amp;lt;br/&amp;gt;  WHEN (:NEW.CODOPT BETWEEN 24 AND 43) AND (:OLD.CODOPT NOT BETWEEN 24 AND 43) THEN&amp;lt;br/&amp;gt;        RAISE_APPLICATION_ERROR (-20145,&amp;apos;Nu puteti modifica coduri intre grupe de optiuni OPTIUNIFISE&amp;apos;) ; &amp;lt;br/&amp;gt;  WHEN (:NEW.CODOPT BETWEEN 92 AND 93) AND (:OLD.CODOPT NOT BETWEEN 92 AND 93) THEN&amp;lt;br/&amp;gt;        RAISE_APPLICATION_ERROR (-20146,&amp;apos;Nu puteti modifica coduri intre grupe de optiuni OPTIUNIFISE&amp;apos;) ; &amp;lt;br/&amp;gt;  WHEN (:NEW.CODOPT BETWEEN 724 AND 773) AND (:OLD.CODOPT NOT BETWEEN 724 AND 733) THEN&amp;lt;br/&amp;gt;        RAISE_APPLICATION_ERROR (-20147,&amp;apos;Nu puteti modifica coduri intre grupe de optiuni OPTIUNIFISE&amp;apos;) ;&amp;lt;br/&amp;gt;  WHEN :NEW.CODOPT BETWEEN 24 AND 43 OR :NEW.CODOPT BETWEEN 92 AND 93 OR :NEW.CODOPT BETWEEN 724 AND 733 THEN&amp;lt;br/&amp;gt;      INSERT INTO UPD_LBSTRAINE VALUES (:NEW.idfisa, :NEW.codopt, :NEW.prioritate, pac_variabile_globale.v_seq_idmodif) ;&amp;lt;br/&amp;gt;  &amp;lt;br/&amp;gt;  &amp;lt;br/&amp;gt;  -- mastere de specializare&amp;lt;br/&amp;gt;  WHEN :NEW.CODOPT BETWEEN 501 AND 520 OR :NEW.CODOPT BETWEEN 601 AND 620 THEN&amp;lt;br/&amp;gt;      INSERT INTO UPD_ms VALUES (:NEW.idfisa, :NEW.codopt, :NEW.prioritate, pac_variabile_globale.v_seq_idmodif) ;      &amp;lt;br/&amp;gt;&amp;lt;br/&amp;gt;  -- mastere complementare&amp;lt;br/&amp;gt;  WHEN :NEW.CODOPT BETWEEN 801 AND 826 OR :NEW.CODOPT BETWEEN 901 AND 917 THEN&amp;lt;br/&amp;gt;      INSERT INTO UPD_mc VALUES (:NEW.idfisa, :NEW.codopt, :NEW.prioritate, pac_variabile_globale.v_seq_idmodif) ;      &amp;lt;br/&amp;gt;&amp;lt;br/&amp;gt;  ELSE&amp;lt;br/&amp;gt;    INSERT INTO UPD_elal VALUES (:NEW.idfisa, :NEW.codopt, :NEW.prioritate,  pac_variabile_globale.v_seq_idmodif) ;&amp;lt;br/&amp;gt;  &amp;lt;br/&amp;gt;  &amp;lt;br/&amp;gt;  END CASE ;  &amp;lt;br/&amp;gt;  &amp;lt;br/&amp;gt;END ;&amp;lt;br/&amp;gt;&amp;lt;br/&amp;gt;&amp;lt;br/&amp;gt;  &amp;lt;br/&amp;gt;  &amp;lt;br/&amp;gt;  &amp;lt;br/&amp;gt;  &amp;lt;br/&amp;gt;</body>
   <triggerTime>AFTER</triggerTime>
   <owner>A19B0135-B306-9C2F-77BB-38712D8BCDB5</owner>
   <table>8470276C-0BA4-8926-C1CF-8138C7723238</table>
</TriggerOraclev10g>